/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/rta/plugin/Plugin","sap/ui/dt/Util","sap/ui/fl/Utils","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/write/api/ExtensionPointRegistryAPI","sap/base/util/values"],function(t,n,e,r,i,a){"use strict";var o=t.extend("sap.ui.rta.plugin.AddXMLAtExtensionPoint",{metadata:{library:"sap.ui.rta",properties:{fragmentHandler:{type:"function"}},associations:{},events:{}}});var s="addXMLAtExtensionPoint";var u="appdescr_ui5_setFlexExtensionPointEnabled";function l(t){var n=t.getId();var e=i.getExtensionPointInfoByParentId({parentId:n});return e.length?e:a(i.getExtensionPointInfoByViewId({viewId:n}))}function p(t){return l(t).length>0}function d(){return sap.ui.getCore().getConfiguration().getDesignMode()}o.prototype.bAppDescriptorCommandAlreadyAvailable=false;o.prototype._isEditable=function(t){if(d()){var n=t.getElement();return this.hasChangeHandler(s,n).then(function(t){return t&&p(n)})}return Promise.resolve(false)};o.prototype.isEnabled=function(t){return t.length===1};o.prototype.isAvailable=function(t){if(d()){var n=t[0].getElement();return p(n)}return false};function f(t,n,r){var i=n.extensionPointName;var a=e.getViewForControl(t);var o={name:i,view:a};var u={fragment:n.fragment,fragmentPath:n.fragmentPath};return this.getCommandFactory().getCommandFor(o,s,u).then(function(t){return r.addCommand(t)})}function m(t,n){var i=r.isFlexExtensionPointHandlingEnabled(t);if(i||this.bAppDescriptorCommandAlreadyAvailable){return Promise.resolve()}var a=e.getAppComponentForControl(t);var o=a.getManifestEntry("sap.app").id;return this.getCommandFactory().getCommandFor(t,"appDescriptor",{reference:o,appComponent:a,changeType:u,parameters:{flexExtensionPointEnabled:true},texts:{}}).then(function(t){this.bAppDescriptorCommandAlreadyAvailable=true;return n.addCommand(t)}.bind(this))}function c(t,n){var e;var r=t[0];var i=r.getElement();return this.getCommandFactory().getCommandFor(i,"composite").then(function(t){e=t}).then(function(){return f.call(this,i,n,e)}.bind(this)).then(function(){return m.call(this,i,e)}.bind(this)).then(function(){return e})}o.prototype.handler=function(t,e){return Promise.resolve().then(function(){var n=e.fragmentHandler||this.getFragmentHandler();if(!n){return Promise.reject("Fragment handler function is not available in the handler")}var r=t[0];var i=r.getElement();var a=l(i);return n(r,a)}.bind(this)).then(function(t){if(!t.extensionPointName||!(typeof t.extensionPointName==="string")){return Promise.reject("Extension point name is not selected!")}if(!t.fragmentPath||!(typeof t.fragmentPath==="string")){return Promise.reject("Fragment path is not available")}return t}).then(function(n){return c.call(this,t,n)}.bind(this)).then(function(t){this.fireElementModified({command:t})}.bind(this)).catch(function(t){throw n.propagateError(t,"AddXMLAtExtensionPoint#handler","Error occurred in AddXMLAtExtensionPoint handler function","sap.ui.rta")})};o.prototype.getMenuItems=function(t){return this._getMenuItems(t,{pluginId:"CTX_ADDXML_AT_EXTENSIONPOINT",rank:110,icon:"sap-icon://add-equipment"})};o.prototype.getActionName=function(){return"AddXMLAtExtensionPoint"};o.prototype.getAction=function(){return{changeType:s}};return o});
//# sourceMappingURL=AddXMLAtExtensionPoint.js.map