/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_omit","sap/base/util/isEmptyObject","sap/ui/dt/Util","sap/ui/rta/plugin/Plugin","sap/ui/rta/plugin/RenameHandler","sap/ui/rta/Utils","sap/ui/fl/write/api/ContextSharingAPI"],function(t,e,a,n,i,r,o){"use strict";var s=n.extend("sap.ui.rta.plugin.CompVariant",{metadata:{library:"sap.ui.rta",properties:{oldValue:{type:"string"}}}});function l(t,e,n,i){var r=t.getDesignTimeMetadata();var o=i||t.getElement();return this.getCommandFactory().getCommandFor(o,e,n,r).then(function(t){this.fireElementModified({command:t})}.bind(this)).catch(function(t){throw a.createError(e,t,"sap.ui.rta.plugin.CompVariant")})}function c(t){return t.getElement().getAllVariants()}function d(t){this.startEdit(t[0])}s.prototype.startEdit=function(t){var e=t.getDesignTimeMetadata().getData().variantRenameDomRef;i.startEdit.call(this,{overlay:t,domRef:e,pluginMethodName:"plugin.CompVariant.startEdit"})};s.prototype.stopEdit=function(t){i._stopEdit.call(this,t,"plugin.CompVariant.stopEdit")};s.prototype._emitLabelChangeEvent=function(){var t=this._oEditedOverlay;var e=t.getElement().getPresentVariantId();var a=i._getCurrentEditableFieldText.call(this);var n={newVariantProperties:{}};n.newVariantProperties[e]={name:a};l.call(this,t,"compVariantUpdate",n)};function u(a){var n=a[0].getElement();var i={layer:this.getCommandFactory().getFlexSettings().layer,contextSharingComponentContainer:o.createComponent(this.getCommandFactory().getFlexSettings()),rtaStyleClass:r.getRtaStyleClassName()};n.openManageViewsDialogForKeyUser(i,function(i){if(!e(i)){l.call(this,a[0],"compVariantUpdate",{newVariantProperties:t(i,["default"]),newDefaultVariantId:i.default,oldDefaultVariantId:n.getDefaultVariantId()})}}.bind(this))}function p(t){return c(t[0]).length>1}function g(t,e){var a=t[0].getElement();l.call(this,t[0],"compVariantSwitch",{targetVariantId:e.eventItem.getParameters().item.getProperty("key"),sourceVariantId:a.getPresentVariantId()})}function h(t){var e=t[0].getElement();e.getPresentVariantContent().then(function(a){var n={onlySave:true,newVariantProperties:{}};n.newVariantProperties[e.getPresentVariantId()]={content:a};l.call(this,t[0],"compVariantUpdate",n)}.bind(this))}function m(t){return t[0].getElement().currentVariantGetModified()}function f(t){var e=t[0].getElement();var a=o.createComponent(this.getCommandFactory().getFlexSettings());e.openSaveAsDialogForKeyUser(r.getRtaStyleClassName(),function(a){if(a){l.call(this,t[0],"compVariantSaveAs",{newVariantProperties:{default:a.default,executeOnSelection:a.executeOnSelection,content:a.content,type:a.type,text:a.text,contexts:a.contexts},previousDirtyFlag:e.getModified(),previousVariantId:e.getPresentVariantId(),previousDefault:e.getDefaultVariantId()})}}.bind(this),a)}function V(t){var e=t[0].getElementInstance();var a=this.getAction(t[0]);return a.handler(e,{styleClass:r.getRtaStyleClassName()}).then(function(a){if(a&&a.length){l.call(this,t[0],"compVariantContent",{variantId:a[0].changeSpecificData.content.key,newContent:a[0].changeSpecificData.content.content,persistencyKey:a[0].changeSpecificData.content.persistencyKey},e.getVariantManagement())}}.bind(this))}s.prototype._isEditable=function(t){return this.hasStableId(t)&&!!this.getAction(t)};s.prototype.getMenuItems=function(t){var e=t[0];var a=e.getElement();var n=[];if(this.isAvailable([e])){if(this.getAction(e).changeType==="variantContent"){n.push({id:"CTX_COMP_VARIANT_CONTENT",text:this.getActionText(e,this.getAction(e)),handler:V.bind(this),enabled:true,rank:250,icon:"sap-icon://key-user-settings"})}else{var i=this.getCommandFactory().getFlexSettings().layer;var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");var o=c(e);var s=o.find(function(t){return t.getVariantId()===a.getPresentVariantId()});if(s.isRenameEnabled(i)){n.push({id:"CTX_COMP_VARIANT_RENAME",text:r.getText("CTX_RENAME"),handler:d.bind(this),enabled:true,rank:210,icon:"sap-icon://edit"})}if(s.isEditEnabled(i)){n.push({id:"CTX_COMP_VARIANT_SAVE",text:r.getText("CTX_VARIANT_SAVE"),handler:h.bind(this),enabled:m,rank:220,icon:"sap-icon://save"})}n.push({id:"CTX_COMP_VARIANT_SAVE_AS",text:r.getText("CTX_VARIANT_SAVEAS"),handler:f.bind(this),enabled:true,rank:230,icon:"sap-icon://duplicate"});n.push({id:"CTX_COMP_VARIANT_MANAGE",text:r.getText("CTX_VARIANT_MANAGE"),handler:u.bind(this),enabled:true,rank:240,icon:"sap-icon://action-settings"});var l=o.map(function(t){var e=a.getPresentVariantId()===t.getVariantId();var n={id:t.getVariantId(),text:t.getText("variantName"),icon:e?"sap-icon://accept":"blank",enabled:!e};return n});n.push({id:"CTX_COMP_VARIANT_SWITCH",text:r.getText("CTX_VARIANT_SWITCH"),handler:g.bind(this),enabled:p,submenu:l,rank:250,icon:"sap-icon://switch-views"})}}return n};s.prototype.getActionName=function(){return"compVariant"};return s});
//# sourceMappingURL=CompVariant.js.map