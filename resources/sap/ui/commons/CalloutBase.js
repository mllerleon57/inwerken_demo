/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/TooltipBase","./CalloutBaseRenderer","sap/ui/core/Popup","sap/ui/events/ControlEvents","sap/ui/events/KeyCodes","sap/ui/dom/jquery/control","sap/ui/dom/jquery/Focusable"],function(jQuery,t,e,o,i,s,n){"use strict";var p=i.Dock;var r=e.extend("sap.ui.commons.CalloutBase",{metadata:{library:"sap.ui.commons",deprecated:true,events:{open:{parameters:{parent:{type:"sap.ui.core.Control"}}},close:{},beforeOpen:{allowPreventDefault:true,parameters:{parent:{type:"sap.ui.core.Control"}}},opened:{}}}});r.prototype.init=function(){this.oPopup=new i;this.oPopup.setShadow(true);this.oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.commons");this.setPosition(p.BeginBottom,p.BeginTop);this.fAnyEventHandlerProxy=jQuery.proxy(this.onAnyEvent,this);var t=this;this.oPopup._applyPosition=function(e){i.prototype._applyPosition.call(this,e);t.setTip()};this.oPopup.setFollowOf(i.CLOSE_ON_SCROLL)};r.prototype.exit=function(){this.oPopup.close();this.oPopup.detachEvent("opened",this.handleOpened,this);this.oPopup.detachEvent("closed",this.handleClosed,this);this.oPopup.destroy();delete this.oPopup;delete this.oRb;s.unbindAnyEvent(this.fAnyEventHandlerProxy)};r.prototype._getPopup=function(){return this.oPopup};r.prototype.hasChild=function(t){return t&&!!jQuery(t).closest(this.getDomRef()).length};r.prototype.isPopupElement=function(t){if(!t){return false}if(this.hasChild(t)){return true}var e=sap.ui.getCore().getStaticAreaRef();var o=parseInt(jQuery(t).closest(jQuery(e).children()).css("z-index"));var i=parseInt(this.$().css("z-index"));return o&&i&&o>=i};r.prototype.setTip=function(){if(!this.oPopup||!this.oPopup.isOpen()){return}var t=this._currentControl.$(),e=this.$(),o=this.$("arrow"),i=e.offset(),s=t.offset(),n=true,p={},r={l:i.left,r:i.left+e.outerWidth(),w:e.outerWidth(),t:i.top,b:i.top+e.outerHeight(),h:e.outerHeight()},u={l:s.left,r:s.left+t.outerWidth(),w:t.outerWidth(),t:s.top,b:s.top+t.outerHeight(),h:t.outerHeight()},h=(e.outerWidth()-e.innerWidth())/2,f=o.outerWidth()*1.4,l=o.outerWidth()/5,a=l-h-8,c=this.getMyPosition();if(r.r<u.l-a){p.x="right"}else if(r.l-a>u.r){p.x="left"}if(r.t>u.b-a){p.y="top"}else if(r.b<u.t+a){p.y="bottom"}if(p.x){var d=0;if(c.indexOf("top")>-1){d=20}else if(c.indexOf("bottom")>-1){d=r.h-20-f}else{d=(r.h-f)/2}var y=r.t+d+f/2+h;if(y<u.t||y>u.b||u.t>r.t&&u.b<r.b){d=(Math.max(r.t,u.t)+Math.min(r.b,u.b))/2-r.t-f/2}o.css(p.x,a+"px");o.css("top",d);if(d<0||d>r.h-f){n=false}}if(p.y){var P=sap.ui.getCore().getConfiguration().getRTL();if(P){c.replace("begin","right").replace("end","left")}var m=0;if(c.indexOf("begin")>-1||c.indexOf("left")>-1){m=20}else if(c.indexOf("right")>-1||c.indexOf("end")>-1){m=r.w-20-f}else{m=(r.w-f)/2}var O=r.l+m+f/2+h;if(O<u.l||O>u.r){m=(Math.max(r.l,u.l)+Math.min(r.r,u.r))/2-r.l-f/2}o.css(p.y,a+"px");o.css("left",m+"px");if(m<0||m>r.w-f){n=false}}if(p.x&&p.y||!p.x&&!p.y){n=false}o.toggle(n)};r.prototype.adjustPosition=function(){function t(){if(this.oPopup){var t=this._currentControl.getDomRef();this.oPopup.setPosition(this.getMyPosition(),this.getAtPosition(),t,this.getOffset(),this.getCollision())}}setTimeout(jQuery.proxy(t,this),0)};r.prototype.focus=function(){if(this.oPopup&&this.oPopup.isOpen()){var t=this.$("cont");u(t.firstFocusableDomRef()||t.get(0))}};r.prototype.openPopup=function(t){if(!this.oPopup||this.oPopup.isOpen()){return}if(e.sOpenTimeout){clearTimeout(e.sOpenTimeout);e.sOpenTimeout=undefined}if(!this.fireEvent("beforeOpen",{parent:this._currentControl},true,false)){if(!this.sCloseNowTimeout){e.sOpenTimeout=setTimeout(function(){this.openPopup(this._currentControl)}.bind(this),200)}return}this.oParentFocusInfo=t.getFocusInfo();this.oPopup.attachEvent("opened",this.handleOpened,this);e.prototype.openPopup.call(this,t);this.adjustPosition();this.fireOpen({parent:this._currentControl})};r.prototype.close=function(){if(this.oPopup&&this.oPopup.isOpen()&&!this.sCloseNowTimeout){if(e.sOpenTimeout){clearTimeout(e.sOpenTimeout);e.sOpenTimeout=undefined}this.closePopup()}};r.prototype.closePopup=function(){var t=this.oPopup!==undefined&&this.oPopup.isOpen();if(this.fAnyEventHandlerProxy){s.unbindAnyEvent(this.onAnyEvent)}e.prototype.closePopup.call(this);if(t&&this._currentControl&&this.bFocused){this._currentControl.applyFocusInfo(this.oParentFocusInfo);this.bFocused=false}this.fireClose()};r.prototype.handleClosed=function(){if(this.oPopup){this.oPopup.detachEvent("closed",this.handleClosed,this);this.fireClosed()}};r.prototype.onkeydown=function(t){var o=t.ctrlKey&&t.which==n.I;var i=t.which==n.ESCAPE;if(!o&&!i){if(jQuery(t.target).control(0)===this._currentControl){this.close()}return}if(o){if(this.oPopup&&this.oPopup.isOpen()){return}this.bDoFocus=true}e.prototype.onkeydown.call(this,t)};r.prototype.handleOpened=function(){this.oPopup.detachEvent("opened",this.handleOpened,this);if(this.bDoFocus){this.focus();this.bDoFocus=false;this.bFocused=true}this.$().css("display","");this.fireOpened();s.bindAnyEvent(this.fAnyEventHandlerProxy)};r.prototype.onfocusin=function(t){this.bFocused=true;var e=t.target;if(e.id===this.getId()+"-fhfe"){u(this.$("cont").lastFocusableDomRef())}else if(e.id===this.getId()+"-fhee"){u(this.$("cont").firstFocusableDomRef())}};r.prototype.onfocusout=function(t){return};r.prototype.onmouseover=function(t){if(this.oPopup&&(this.oPopup.isOpen()&&this.oPopup.getContent()==this)){if(this.sCloseNowTimeout){clearTimeout(this.sCloseNowTimeout);this.sCloseNowTimeout=null}return}else{e.prototype.onmouseover.call(this,t)}};r.prototype.onmouseout=function(t){if(this.oPopup&&(this.oPopup.isOpen()&&this.isPopupElement(t.relatedTarget))){return}e.prototype.onmouseout.call(this,t)};r.prototype.onmousedown=function(t){if(jQuery(t.target).control(0)===this._currentControl){this.close();this.removeStandardTooltips()}};r.prototype.onAnyEvent=function(t){if(this.oPopup&&!this.oPopup.isOpen()||t.type!="mouseover"||this.hasChild(t.target)){return}var o=this.isPopupElement(t.target)||jQuery(t.target).control(0)===this._currentControl;if(!o&&!this.sCloseNowTimeout&&!e.sOpenTimeout){this.sCloseNowTimeout=setTimeout(function(){this.closePopup()}.bind(this),400)}if(o&&this.sCloseNowTimeout){clearTimeout(this.sCloseNowTimeout);this.sCloseNowTimeout=null}};r.prototype.setPosition=function(t,e){var o=t||p.BeginBottom;var i=e||p.BeginTop;var s=0,n=0,r=0,u=0,h=5;if(o.indexOf("begin")>-1||o.indexOf("left")>-1){s=-1}else if(o.indexOf("right")>-1||o.indexOf("end")>-1){s=1}if(i.indexOf("begin")>-1||i.indexOf("left")>-1){r=-1}else if(i.indexOf("right")>-1||i.indexOf("end")>-1){r=1}if(o.indexOf("top")>-1){n=-1}else if(o.indexOf("bottom")>-1){n=1}if(i.indexOf("top")>-1){u=-1}else if(i.indexOf("bottom")>-1){u=1}var f=(s-r)*s*r*h+" "+(n-u)*n*u*h;this.setMyPosition(o);this.setAtPosition(i);this.setOffset(f);return this};function u(t){if(t){t.focus()}}return r});
//# sourceMappingURL=CalloutBase.js.map