/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/valuehelp/base/Container","sap/ui/mdc/util/loadModules","sap/ui/dom/units/Rem","sap/ui/thirdparty/jquery","sap/ui/core/library"],function(t,e,o,jQuery,n){"use strict";var i,r,a,s,p;var l=n.ValueState;var u=t.extend("sap.ui.mdc.valuehelp.Popover",{metadata:{library:"sap.ui.mdc",interfaces:["sap.ui.mdc.valuehelp.ITypeaheadContainer","sap.ui.mdc.valuehelp.IDialogContainer"],properties:{},defaultAggregation:"content"}});u.prototype.invalidate=function(e){if(e){var o=this.getAggregation("_container");var n=this._oCurrentContent;if(o&&n&&e===n&&!this._bIsBeingDestroyed){o.invalidate(e)}else{t.prototype.invalidate.apply(this,arguments)}}};u.prototype._getUIAreaForContent=function(){var e=this.getAggregation("_container");if(e){return e.getUIArea()}return t.prototype._getUIAreaForContent.apply(this,arguments)};u.prototype._getContent=function(){var t=this.getContent();return t&&t[0]};u.prototype._getContainer=function(){var t=this.getAggregation("_container");var o=function(t,e){if(t&&t.getValueState&&t.getValueState()!==l.None){e.setText(t.getValueStateText());e.setValueState(t.getValueState());e.setVisible(true)}else{e.setVisible(false)}};if(!t){return e(["sap/m/Popover","sap/m/library","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/ValueStateHeader"]).then(function(e){i=e[0];r=e[1];a=e[2];s=e[3];p=e[4];var n=new p;o(this.getControl(),n);t=new i(this.getId()+"-pop",{contentHeight:"auto",placement:r.PlacementType.VerticalPreferredBottom,showHeader:false,showArrow:false,title:this.getTitle(),titleAlignment:r.TitleAlignment.Center,afterOpen:this._handleOpened.bind(this),afterClose:this._handleClosed.bind(this),customHeader:n}).addStyleClass("sapMdcValueHelpPopover").addStyleClass("sapMComboBoxBasePicker").addStyleClass("sapMComboBoxBasePicker-CTX");if(n){n.setPopup(t)}t.isPopupAdaptationAllowed=function(){return false};t.addStyleClass(this._isSingleSelect()?"sapMdcValueHelpSingleSelect":"sapMdcValueHelpMultiSelect");t.addDelegate({onsapshow:this._handleRequestSwitchToDialog.bind(this)});t._getAllContent=function(){var t=this.getParent();var e=[];if(t){if(this._oCurrentContent){e.push(this._oCurrentContent)}}return e}.bind(this);var l=this._getContent();var u=this._getContainerConfig(l);if(u){t.setShowArrow(!!u.showArrow);t.setShowHeader(!!u.showHeader);t.setResizable(!!u.resizable);if(u.getContentWidth){t.setContentWidth(u.getContentWidth())}}this.setAggregation("_container",t,true);return t}.bind(this))}o(this.getControl(),t.getCustomHeader());return t};var h=function(){var t=this.getAggregation("_container");var e=this._getContent();var n=e&&this._getContainerConfig(e);if(t&&n&&n.getContentHeight){var i=n.getContentHeight();var r=t.$().find(".sapMPopoverCont").height();var a=r<o.toPx("30rem");t.setContentHeight(!i||a||r>=i?"auto":"30rem");t.invalidate()}};u.prototype.providesScrolling=function(){return true};u.prototype._observeChanges=function(e){if(e.name==="content"){var o=e.child;if(e.mutation==="remove"){o.detachEvent("contentUpdated",h,this);o.detachNavigated(this._handleNavigated,this)}else{o.attachEvent("contentUpdated",h,this)}}t.prototype._observeChanges.apply(this,arguments)};u.prototype._placeContent=function(t){var e=this._getContent();var o=e&&e.getContent();var n=this._getContainerConfig(e);var i=n&&n.getFooter&&n.getFooter();return Promise.all([o,i]).then(function(e){this._oCurrentContent=e[0];var o=e[1];var n=this.getControl();this._oCurrentContent.setFieldGroupIds(n.getFieldGroupIds());if(o&&t.getFooter()!=o&&o.isA&&o.isA("sap.m.Toolbar")){t.setFooter(o);return t}if(o){if(!t.getFooter()){var i=[new s(this.getId()+"-Spacer")].concat(o);var r=new a(this.getId()+"-TB",{content:i}).setModel(this._oManagedObjectModel,"$help");t.setFooter(r)}else{}}else if(t.getFooter()){t.setFooter()}return t}.bind(this))};u.prototype._open=function(e){if(e.isOpen()){return}t.prototype._open.apply(this,arguments);var o=this._getContent();Promise.resolve(o&&o.onBeforeShow(true)).then(function(){var t=this.getControl();var o=t&&t.getFocusElementForValueHelp?t.getFocusElementForValueHelp(this.isTypeahead()):t;if(o&&o.getDomRef()){e.setContentMinWidth(jQuery(o.getDomRef()).outerWidth()+"px");if(!this.isFocusInHelp()){e.setInitialFocus(o)}e.openBy(o)}}.bind(this))};u.prototype._close=function(){t.prototype._close.apply(this,arguments);var e=this.getAggregation("_container");if(e){e.close()}};u.prototype._handleOpened=function(){h.call(this);t.prototype._handleOpened.apply(this,arguments);var e=this._getContent();if(e){e.onContainerOpen();e.onShow(true)}};u.prototype._handleConfirmed=function(t){this.fireConfirm({close:t.getParameter("close")||this._isSingleSelect()})};u.prototype._handleClosed=function(e){var o=this._getContent();if(o){o.onHide();o.onContainerClose()}var n=this.getAggregation("_container");if(n){n._oPreviousFocus=null}t.prototype._handleClosed.apply(this,arguments)};u.prototype.removeFocus=function(){var t=this._getContent();if(t){t.removeFocus()}};u.prototype._navigate=function(t){var e=this._getContent();if(e){return e.navigate(t)}};u.prototype.getItemForValue=function(t){var e=this._getContent();if(e){return e.getItemForValue(t)}};u.prototype.isValidationSupported=function(t){var e=this._getContent();if(e){return e.isValidationSupported()}};u.prototype.getUseAsValueHelp=function(){var t=this._getContent();return t&&t.getUseAsValueHelp&&t.getUseAsValueHelp()};u.prototype.getValueHelpIcon=function(){var t=this._getContent();return t&&t.getValueHelpIcon()};u.prototype.getAriaAttributes=function(e){var o=this._getContent();var n=o&&o.getAriaAttributes(e);if(n){return{contentId:n.contentId,ariaHasPopup:n.ariaHasPopup,role:this.isDialog()?"combobox":null,roleDescription:n.roleDescription}}return t.prototype.getAriaAttributes.apply(this,arguments)};u.prototype.shouldOpenOnClick=function(){var t=this._getContent();return!!t&&t.shouldOpenOnClick()};u.prototype.shouldOpenOnNavigate=function(){var t=this._getContent();return!!t&&t.shouldOpenOnNavigate()};u.prototype.isFocusInHelp=function(){var t=this._getContent();return!!t&&t.isFocusInHelp()};u.prototype.isMultiSelect=function(){var t=this._getContent();return!!t&&t.isMultiSelect()};u.prototype.isTypeaheadSupported=function(){var t=this._getContent();return t&&t.isSearchSupported()};u.prototype.exit=function(){if(this._oCurrentContent){if(!this._oCurrentContent.bIsDestroyed){this._oCurrentContent.destroy()}this._oCurrentContent=null}t.prototype.exit.apply(this,arguments)};return u});
//# sourceMappingURL=Popover.js.map