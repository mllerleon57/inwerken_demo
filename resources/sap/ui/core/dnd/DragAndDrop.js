/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../library","sap/ui/Device","sap/ui/core/Element","../UIArea","sap/ui/thirdparty/jquery"],function(t,e,r,n,jQuery){"use strict";var i=t.dnd.RelativeDropPosition;var o={},a=null,f=null,g=null,s=[],u=[],l=null,d,c,p,D,h={},v;function m(t,e){if(!t){return}if(t.addStyleClass){t.addStyleClass(e)}else{t.$().addClass(e)}}function w(t,e){if(!t){return}if(t.removeStyleClass){t.removeStyleClass(e)}else{t.$().removeClass(e)}}function C(t,e){var n=r.closestTo(t.target,true);if(!n){return}var i=jQuery.Event(null,t);i.type=e;n.getUIArea()._handleEvent(i)}function b(t){return!t.disabled&&/^(input|textarea)$/.test(t.localName)}function E(t,e){if(!t||!t.getDragGhost){return}var r=t.getDragGhost();if(!r){return}if(!c){c=jQuery('<div class="sapUiDnDGhostContainer"></div>');jQuery(document.body).append(c)}c.append(r);window.setTimeout(function(){c.empty()},0);var n=e.originalEvent;n.dataTransfer.setDragImage(r,n.offsetX,n.offsetY)}function y(t){var e={},r,n=t.originalEvent.dataTransfer,i=function(t,e){n.setData(t,e)};return{setData:function(t,r){r=""+r;e[t]=r;i(t,r)},getData:function(t){return e[t]},setTextData:function(t){t=""+t;e["text/plain"]=t;e["text"]=t;i("text/plain",t);i("text",t)},getTextData:function(){return e["text/plain"]},setComplexData:function(t,r){e[t]=r},getComplexData:function(t){return e[t]},getIndicator:function(){return d&&d[0]},setIndicatorConfig:function(t){r=t},getIndicatorConfig:function(t){return r},getDragControl:function(){return a},getDropControl:function(){return g},setDropControl:function(t){g=t},getDropInfo:function(){return u[0]||null},getDropPosition:function(){return p}}}function S(t){a=f=g=l=null;p="";s=[];u=[]}function T(){if(d){return d}d=jQuery("<div class='sapUiDnDIndicator'></div>");jQuery(sap.ui.getCore().getStaticAreaRef()).append(d);return d}function O(){if(d){d.removeAttr("style");d.hide();h={}}}function A(t,e,r,n){if(!e){return}var o=t.dragSession&&t.dragSession.getIndicatorConfig(),a=e.getBoundingClientRect(),f=window.pageYOffset,g=window.pageXOffset,s=T(),u,l={},d={top:a.top+f,bottom:a.bottom+f,left:a.left+g,right:a.right+g,width:a.width,height:a.height};if(!r||r=="On"){u=i.On;n=""}else if(n=="Horizontal"){var c=t.pageX-d.left;l.height=d.height;l.top=d.top;if(r=="Between"){l.width="";if(c<d.width*.5){u=i.Before;l.left=d.left}else{u=i.After;l.left=d.right}}else if(r=="OnOrBetween"){if(c<d.width*.25){u=i.Before;l.left=d.left;l.width=""}else if(c>d.width*.75){u=i.After;l.left=d.right;l.width=""}else{u=i.On}}if(u!=i.On&&sap.ui.getCore().getConfiguration().getRTL()){u=u==i.After?i.Before:i.After}}else{var p=t.pageY-d.top;l.width=d.width;l.left=d.left;if(r=="Between"){l.height="";if(p<d.height*.5){u=i.Before;l.top=d.top}else{u=i.After;l.top=d.bottom}}else if(r=="OnOrBetween"){if(p<d.height*.25){u=i.Before;l.top=d.top;l.height=""}else if(p>d.height*.75){u=i.After;l.top=d.bottom;l.height=""}else{u=i.On}}}if(o&&o.display=="none"){return u}if(u==i.On){l.top=d.top;l.left=d.left;l.width=d.width;l.height=d.height;r=u}else{r="Between"}if(h.top!=l.top||h.left!=l.left||h.width!=l.width||h.height!=l.height){s.attr("data-drop-layout",n);s.attr("data-drop-position",r);s.css(Object.assign(l,o));s.show();h=l}return u}function x(t){var e=t.getParent(),r=t.getDragDropConfig?t.getDragDropConfig():[],n=e&&e.getDragDropConfig?e.getDragDropConfig():[];return r.concat(n)}function I(t){var e=x(t);return e.filter(function(e){return e.isDraggable(t)})}function B(t,e,r){var n=x(t);e=e||[];return n.filter(function(t){return!t.isA("sap.ui.core.dnd.IDragInfo")}).concat(e).filter(function(n){if(!n.isDroppable(t,r)){return false}var i=n.getGroupName();if(!i){return true}return e.some(function(t){return t.getGroupName()==i})})}function N(t,e){t.preventDefault();if(a){var r=e.getDropEffect().toLowerCase();t.originalEvent.dataTransfer.dropEffect=r}}function U(t,e,r){var n=e.getTargetAggregation();if(!n){return A(t,r.getDomRef())}var i;if(t.getMark("DragWithin")==n){i=r.getDomRefForSetting(n)}i=i||r.getDomRef();return A(t,i,e.getDropPosition(true),e.getDropLayout(true))}o.preprocessEvent=function(t){if(l&&t.type.indexOf("dr")==0){t.dragSession=l}var e="onbefore"+t.type;if(o[e]){o[e](t)}};o.postprocessEvent=function(t){var e="onafter"+t.type;if(o[e]){o[e](t)}};o.onbeforemousedown=function(t){if(e.browser.firefox&&b(t.target)){v=jQuery(t.target).closest("[data-sap-ui-draggable=true]").prop("draggable",false)[0]}};o.onbeforemouseup=function(t){if(v){v.draggable=true;v=null}};o.onbeforedragstart=function(t){if(!t.target.draggable){return}if(b(document.activeElement)){t.target.getAttribute("data-sap-ui-draggable")&&t.preventDefault();return}a=r.closestTo(t.target,true);if(!a){return}s=I(a);if(!s.length){return}if(!e.system.desktop&&!t.originalEvent.dataTransfer.getData("text")){t.originalEvent.dataTransfer.setData("text"," ")}t.dragSession=l=y(t)};o.onafterdragstart=function(t){if(!s.length||t.isDefaultPrevented()){S();return}s=t.isMarked("NonDraggable")?[]:s.filter(function(e){return e.fireDragStart(t)});if(!s.length){t.preventDefault();S();return}E(a,t);m(a,"sapUiDnDDragging");if(jQuery(t.target).closest(".sapUiScrollDelegate")[0]){jQuery("html").addClass("sapUiDnDNoScrolling")}};o.onbeforedragenter=function(t){var e=r.closestTo(t.target,true);if(e&&f===e){t.setMark("DragWithin","SameControl")}else{D=Date.now();f=e}var n=[],i;g=e;for(var o=0;o<20&&g;o++){n=B(g,s,t);if(n.length){break}i=g.getDomRef();i=i&&i.parentElement;g=r.closestTo(i,true)}if(t.getMark("DragWithin")!="SameControl"){u=n;if(l){l.setIndicatorConfig(null)}}if(!u.length){g=null}else if(!l){t.dragSession=l=y(t)}};o.onafterdragenter=function(t){if(!g||t.isMarked("NonDroppable")){u=[]}else if(t.getMark("DragWithin")!="SameControl"){u=u.filter(function(e){return e.fireDragEnter(t)})}var e=u[0];if(!e||e.getDropEffect()=="None"){O();p=""}else{N(t,e);p=U(t,e,g)}};o.onbeforedragover=function(t){var e=Date.now();if(e-D>=1e3){C(t,"longdragover");D=e}};o.onafterdragover=function(t){var e=u[0];if(!e||e.getDropEffect()=="None"){return}u.forEach(function(e){e.fireDragOver(t)});N(t,e);if(e&&e.getDropPosition(true)=="On"){return}p=U(t,e,g)};o.onbeforedrop=function(t){if(u.length){t.preventDefault()}};o.onafterdrop=function(t){u.forEach(function(e){e.fireDrop(t)});this.iDragEndTimer=window.requestAnimationFrame(this.onafterdragend.bind(this,t))};o.onafterdragend=function(t){this.iDragEndTimer=window.cancelAnimationFrame(this.iDragEndTimer);s.forEach(function(e){e.fireDragEnd(t)});w(a,"sapUiDnDDragging");jQuery("html").removeClass("sapUiDnDNoScrolling");O();S()};n.addEventPreprocessor(o.preprocessEvent);n.addEventPostprocessor(o.postprocessEvent);return o},true);
//# sourceMappingURL=DragAndDrop.js.map