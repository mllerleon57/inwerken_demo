/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../base/Object","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/dom/_ready"],function(t,o,jQuery,e){"use strict";var n;var r;var s=t.extend("sap.ui.core.FocusHandler",{constructor:function(){t.apply(this);this.oCurrent=null;this.oLast=null;this.aEventQueue=[];this.oLastFocusedControlInfo=null;this.oPatchingControlFocusInfo=null;this.fnEventHandler=this.onEvent.bind(this);e().then(function(){var t=document.body;t.addEventListener("focus",this.fnEventHandler,true);t.addEventListener("blur",this.fnEventHandler,true);o.debug("FocusHandler setup on Root "+t.type+(t.id?": "+t.id:""),null,"sap.ui.core.FocusHandler")}.bind(this))}});s.prototype.getCurrentFocusedControlId=function(){var t;try{var o=jQuery(document.activeElement);if(o.is(":focus")){if(!n){n=sap.ui.require("sap/ui/core/Element")}t=n&&n.closestTo(o[0])}}catch(t){}return t?t.getId():null};s.prototype.getControlFocusInfo=function(t){var o;t=t||this.getCurrentFocusedControlId();if(!t){return null}o=a(t);if(o){return{id:t,control:o,info:o.getFocusInfo(),type:o.getMetadata().getName(),focusref:o.getFocusDomRef()}}return null};s.prototype.storePatchingControlFocusInfo=function(t){var o=document.activeElement;if(!o||!t.contains(o)){this.oPatchingControlFocusInfo=null}else{this.oPatchingControlFocusInfo=this.getControlFocusInfo();if(this.oPatchingControlFocusInfo){this.oPatchingControlFocusInfo.patching=true}}};s.prototype.getPatchingControlFocusInfo=function(){return this.oPatchingControlFocusInfo};s.prototype.updateControlFocusInfo=function(t){if(t&&this.oLastFocusedControlInfo&&this.oLastFocusedControlInfo.control===t){var e=t.getId();this.oLastFocusedControlInfo=this.getControlFocusInfo(e);o.debug("Update focus info of control "+e,null,"sap.ui.core.FocusHandler")}};s.prototype.restoreFocus=function(t){var e=t||this.oLastFocusedControlInfo;if(!e){return}var n=a(e.id);var r=e.focusref;if(n&&e.info&&n.getMetadata().getName()==e.type&&(e.patching||n.getFocusDomRef()!=r&&(t||n!==e.control||e.preserved))){o.debug("Apply focus info of control "+e.id,null,"sap.ui.core.FocusHandler");e.control=n;this.oLastFocusedControlInfo=e;delete this.oLastFocusedControlInfo.patching;n.applyFocusInfo(e.info)}else{o.debug("Apply focus info of control "+e.id+" not possible",null,"sap.ui.core.FocusHandler")}};s.prototype.destroy=function(t){var o=t.data.oRootRef;if(o){o.removeEventListener("focus",this.fnEventHandler,true);o.removeEventListener("blur",this.fnEventHandler,true)}};s.prototype.onEvent=function(t){var e=jQuery.event.fix(t);o.debug("Event "+e.type+" reached Focus Handler (target: "+e.target+(e.target?e.target.id:"")+")",null,"sap.ui.core.FocusHandler");var n=e.type=="focus"||e.type=="focusin"?"focus":"blur";this.aEventQueue.push({type:n,controlId:u(e.target)});if(this.aEventQueue.length==1){this.processEvent()}};s.prototype.processEvent=function(){var t=this.aEventQueue[0];if(!t){return}try{if(t.type=="focus"){this.onfocusEvent(t.controlId)}else if(t.type=="blur"){this.onblurEvent(t.controlId)}}finally{this.aEventQueue.shift();if(this.aEventQueue.length>0){this.processEvent()}}};s.prototype.onfocusEvent=function(t){var e=a(t);if(e){this.oLastFocusedControlInfo=this.getControlFocusInfo(t);o.debug("Store focus info of control "+t,null,"sap.ui.core.FocusHandler")}this.oCurrent=t;if(!this.oLast){return}if(this.oLast!=this.oCurrent){i(this.oLast,t)}this.oLast=null};s.prototype.onblurEvent=function(t){if(!this.oCurrent){return}this.oLast=t;this.oCurrent=null;setTimeout(this["checkForLostFocus"].bind(this),0)};s.prototype.checkForLostFocus=function(){if(this.oCurrent==null&&this.oLast!=null){i(this.oLast,null)}this.oLast=null};s.prototype.trackFocusForPreservedElement=function(t){if(t.contains(document.activeElement)&&this.oLastFocusedControlInfo&&document.activeElement===this.oLastFocusedControlInfo.focusref){this.oLastFocusedControlInfo.preserved=true}};var u=function(t){var o=jQuery(t).closest("[data-sap-ui]").attr("id");if(o){return o}return null};var i=function(t,o){var e=a(t);if(e){var n=jQuery.Event("sapfocusleave");n.target=e.getDomRef();var s=a(o);n.relatedControlId=s?s.getId():null;n.relatedControlFocusInfo=s?s.getFocusInfo():null;r=r||sap.ui.require("sap/ui/core/Core");if(r){var u=e.getUIArea();var i=null;if(u){i=r.getUIArea(u.getId())}else{var c=r.getStaticAreaRef();if(c.contains(n.target)){i=r.getUIArea(c.id)}}if(i){i._handleEvent(n)}}}};function a(t){var o;if(!n){n=sap.ui.require("sap/ui/core/Element")}if(n){o=n.registry.get(t)}return o||null}return new s});
//# sourceMappingURL=FocusHandler.js.map