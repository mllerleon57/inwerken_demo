/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","./Element","./RenderManager","./FocusHandler","sap/ui/performance/trace/Interaction","sap/ui/util/ActivityDetection","sap/ui/events/KeyCodes","sap/base/Log","sap/base/assert","sap/ui/performance/Measurement","sap/ui/events/jquery/EventExtension","sap/ui/events/ControlEvents","sap/ui/events/F6Navigation","sap/ui/thirdparty/jquery"],function(e,t,n,o,r,i,a,s,d,u,l,f,g,jQuery){"use strict";l.apply();jQuery(document).on("keydown",function(e){g.handleF6GroupNavigation(e,null)});var p=s.getLogger("sap.ui.Rendering",window["sap-ui-config"]&&(window["sap-ui-config"]["xx-debugRendering"]||window["sap-ui-config"]["xx-debugrendering"])||/sap-ui-xx-debug(R|-r)endering=(true|x|X)/.test(document.location.search)?s.Level.DEBUG:Math.min(s.Level.INFO,s.getLevel())),c=function(e){return e},h=function(){},v=function(){};if(p.isLoggable()){c=function(e){var t;try{throw new Error}catch(e){t=e.stack||e.stacktrace||(e.sourceURL?e.sourceURL+":"+e.line:null);t=t?t.split(/\n\s*/g).slice(2):undefined}return{obj:e,location:t}};h=function(e,t){var n=sap.ui.getCore(),o={},r,i;for(r in t){i=n.byId(r);o[r]={type:i?i.getMetadata().getName():t[r].obj===e?"UIArea":"(no such control)",location:t[r].location,reason:t[r].reason}}p.debug("  UIArea '"+e.getId()+"', pending updates: "+JSON.stringify(o,null,"\t"))};v=function(e,t){var n;for(n in t){if(e[n]!=null){if(e[n].obj!==t[n].obj){t[n].reason="replaced during rendering"}else{t[n].reason="invalidated again during rendering"}}else{t[n].reason="invalidated during rendering"}}}}var y=e.extend("sap.ui.core.UIArea",{constructor:function(t,n){if(arguments.length===0){return}e.apply(this);this.oCore=t;this.bLocked=false;this.bInitial=true;this.aContentToRemove=[];this.bNeedsRerendering=false;if(n!=null){this.setRootNode(n);this.bNeedsRerendering=this.bNeedsRerendering&&!document.getElementById(n.id+"-Init")}this.mInvalidatedControls={};if(!this.bNeedsRerendering){this.bRenderSelf=false}else{this.oCore.addInvalidatedUIArea(this)}},metadata:{publicMethods:["setRootNode","getRootNode","setRootControl","getRootControl","lock","unlock","isLocked","_handleEvent"],aggregations:{content:{name:"content",type:"sap.ui.core.Control",multiple:true,singularName:"content"},dependents:{name:"dependents",type:"sap.ui.core.Control",multiple:true}}},insertDependent:function(e,t){return this.insertAggregation("dependents",e,t,true)},addDependent:function(e){return this.addAggregation("dependents",e,true)},removeDependent:function(e){return this.removeAggregation("dependents",e,true)},removeAllDependents:function(){return this.removeAllAggregation("dependents",true)},destroyDependents:function(){return this.destroyAggregation("dependents",true)}});y.prototype.isInvalidateSuppressed=function(){return this.iSuppressInvalidate>0};y.prototype.getId=function(){return this.oRootNode?this.oRootNode.id:null};y.prototype.getUIArea=function(){return this};y.prototype.setRootNode=function(e){if(this.oRootNode===e){return}d(!e||e.nodeType===1&&!jQuery(e).attr("data-sap-ui-area"),"UIArea root node must be a DOMElement");if(this.oRootNode){this._ondetach()}this.oRootNode=e;if(this.getContent().length>0){this.invalidate()}if(this.oRootNode){this._onattach()}};y.prototype.getRootNode=function(){return this.oRootNode};y.prototype.setRootControl=function(e){this.removeAllContent();this.addContent(e)};y.prototype.getRootControl=function(e){var t=this.getContent();if(t.length>0){if(e>=0&&e<t.length){return t[e]}return t[0]}return null};y.prototype._addRemovedContent=function(e){if(this.oRootNode&&e){this.aContentToRemove.push(e)}};y.prototype.addContent=function(e,t){this.addAggregation("content",e,t);if(t!==true){this.invalidate()}return this};y.prototype.removeContent=function(e,t){var n=this.removeAggregation("content",e,t);if(!t){var o;if(n&&n.getDomRef){o=n.getDomRef()}this._addRemovedContent(o)}return n};y.prototype.removeAllContent=function(){var e=this.removeAllAggregation("content");for(var t=0;t<e.length;t++){var n;var o=e[t];if(o&&o.getDomRef){n=o.getDomRef()}this._addRemovedContent(n)}return e};y.prototype.destroyContent=function(){var e=this.getContent();for(var t=0;t<e.length;t++){var n;var o=e[t];if(o&&o.getDomRef){n=o.getDomRef()}this._addRemovedContent(n)}this.destroyAggregation("content");return this};y.prototype.lock=function(){this.bLocked=true};y.prototype.unlock=function(){if(this.bLocked&&this.bNeedsRerendering){this.oCore.addInvalidatedUIArea(this)}this.bLocked=false};y.prototype.isLocked=function(){return this.bLocked};y.prototype.getBindingContext=function(){return null};y.prototype.getEventingParent=function(){return this.oCore._getEventProvider()};y.prototype.isActive=function(){return!!this.getId()&&document.getElementById(this.getId())!=null};y.prototype.invalidate=function(){this.addInvalidatedControl(this)};y.prototype.addInvalidatedControl=function(e){if(this.bRenderSelf){return}if(!this.bNeedsRerendering){this.oCore.addInvalidatedUIArea(this)}var t=e.getId();if(e===this){this.bRenderSelf=true;this.bNeedsRerendering=true;this.mInvalidatedControls={};this.mInvalidatedControls[t]=c(this);return}if(this.mInvalidatedControls[t]){return}if(!this.bRenderSelf){this.mInvalidatedControls[t]=c(e);this.bNeedsRerendering=true}};y.prototype.rerender=function(e){var t=this;function r(){t.bRenderSelf=false;t.aContentToRemove=[];t.mInvalidatedControls={};t.bNeedsRerendering=false}if(e){this.bNeedsRerendering=true}if(this.bLocked||!this.bNeedsRerendering){return false}var i=this.bRenderSelf,a=this.aContentToRemove,d=this.mInvalidatedControls,l=false;r();u.pause("renderPendingUIUpdates");u.start(this.getId()+"---rerender","Rerendering of "+this.getMetadata().getName());h(this,d);if(i){if(this.oRootNode){p.debug("Full Rendering of UIArea '"+this.getId()+"'");n.preserveContent(this.oRootNode,false,this.bInitial);this.bInitial=false;var f=function(e,o){var r=e.length;var i;for(var a=0;a<r;a++){i=o?e[a].getDomRef():e[a];if(i&&!n.isPreservedContent(i)&&t.oRootNode===i.parentNode){jQuery(i).remove()}}return r};var g=document.activeElement;var c=o.getControlFocusInfo();f(a);var y=this.getContent();var m=f(y,true);var C=document.activeElement;for(var R=0;R<m;R++){if(y[R]&&y[R].getParent()===this){this.oCore.oRenderManager.render(y[R],this.oRootNode,true)}}l=true;if(g&&g!=C&&C===document.activeElement){try{o.restoreFocus(c)}catch(e){s.warning("Problems while restoring the focus after full UIArea rendering: "+e,null,this)}}}else{p.debug("Full Rendering of UIArea '"+this.getId()+"' postponed, no root node")}}else{var I=function(e){for(;;){if(e.getMetadata&&e.getMetadata().isInstanceOf("sap.ui.core.PopupInterface")){break}e=e.getParent();if(!e||e===t){return false}if(d.hasOwnProperty(e.getId())){return true}}};for(var b in d){var N=this.oCore.byId(b);if(N&&!I(N)){N.rerender();l=true}}}v(d,this.mInvalidatedControls);u.end(this.getId()+"---rerender");u.resume("renderPendingUIUpdates");return l};y.prototype._onControlRendered=function(e){var t=e.getId();if(this.mInvalidatedControls[t]){delete this.mInvalidatedControls[t]}};y.rerenderControl=function(e){var t=null;if(e){t=e.getDomRef();if(!t||n.isPreservedContent(t)){t=document.getElementById(n.RenderPrefixes.Invisible+e.getId())}}var o=t&&t.parentNode;if(o){var r=e.getUIArea();var i=r?r.oCore.oRenderManager:sap.ui.getCore().createRenderManager();p.debug("Rerender Control '"+e.getId()+"'"+(r?"":" (using a temp. RenderManager)"));n.preserveContent(t,true,false,e);i.render(e,o)}else{var r=e.getUIArea();r&&r._onControlRendered(e);p.warning("Couldn't rerender '"+e.getId()+"', as its DOM location couldn't be determined")}};var m=/^(mousedown|mouseup|click|keydown|keyup|keypress|touchstart|touchend|tap)$/;var C=[],R=[];var I={mousemove:1,mouseover:1,mouseout:1,scroll:1,dragover:1,dragenter:1,dragleave:1};y.addEventPreprocessor=function(e){C.push(e)};y.getEventPreprocessors=function(){return C};y.addEventPostprocessor=function(e){R.push(e)};y.getEventPostprocessors=function(){return R};y.configureEventLogging=function(e){Object.assign(I,e);return Object.assign({},I)};y.prototype._handleEvent=function(e){var n,o,a;n=o=t.closestTo(e.target);i.refresh();if(n==null){return}if(e.isMarked("delayedMouseEvent")){return}var d=e.getMark("handledByUIArea"),u=this.getId();if(d&&d!==u){e.setMark("firstUIArea",false);return}e.setMarked("firstUIArea");e.srcControl=n;if(e.type==="contextmenu"&&e.shiftKey&&e.altKey&&(e.metaKey||e.ctrlKey)){s.info("Suppressed forwarding the contextmenu event as control event because CTRL+SHIFT+ALT is pressed!");return}C.forEach(function(t){t(e)});this.oCore._handleControlEvent(e,u);if(this.bLocked||this.oCore.isLocked()){return}if(r.getActive()){a=e.type.match(m);if(a){r.notifyEventStart(e)}}var l=[];if(e.getPseudoTypes){l=e.getPseudoTypes()}l.push(e.type);var f=false;while(o instanceof t&&o.isActive()&&!e.isPropagationStopped()){var g=e.getMark("scopeCheckId"),p=g&&window.document.getElementById(g),c=o.getDomRef();if(!p||c&&c.contains(p)){for(var h=0,v=l.length;h<v;h++){var y=l[h];e.type=y;e.currentTarget=o.getDomRef();o._handleEvent(e);if(e.isImmediatePropagationStopped()){break}}if(!f&&!e.isMarked("enterKeyConsumedAsContent")){f=this._handleGroupChange(e,o)}if(e.isPropagationStopped()){break}if(o.bStopEventBubbling){break}c=o.getDomRef();if(!c){break}}c=c.parentNode;o=null;if(e.isMarked("fromMouseout")&&(c&&c.contains(e.relatedTarget))){break}while(c&&c!==this.getRootNode()){if(c.id){o=t.closestTo(c);if(o){break}}c=c.parentNode}}R.forEach(function(t){t(e)});if(a){r.notifyEventEnd(e)}e.currentTarget=this.getRootNode();e.setMark("handledByUIArea",u);if(e.isPropagationStopped()){s.debug("'"+e.type+"' propagation has been stopped")}var b=e.type;if(!I[b]){if(n){s.debug("Event fired: '"+b+"' on "+n,"","sap.ui.core.UIArea")}else{s.debug("Event fired: '"+b+"'","","sap.ui.core.UIArea")}}};y.prototype._onattach=function(){var e=this.getRootNode();if(e==null){return}jQuery(e).attr("data-sap-ui-area",e.id).on(f.events.join(" "),this._handleEvent.bind(this))};y.prototype._ondetach=function(){var e=this.getRootNode();if(e==null){return}jQuery(e).removeAttr("data-sap-ui-area").off()};y.prototype.clone=function(){throw new Error("UIArea can't be cloned")};y.prototype._handleGroupChange=function(e,n){var o=y._oFieldGroupValidationKey;if(e.type==="focusin"||e.type==="focusout"){if(e.type==="focusout"){n=t.closestTo(document.activeElement)}if(y._iFieldGroupDelayTimer){clearTimeout(y._iFieldGroupDelayTimer);y._iFieldGroupDelayTimer=null}y._iFieldGroupDelayTimer=setTimeout(this.setFieldGroupControl.bind(this,n),0);return true}else if(this.getFieldGroupControl()&&e.type==="keyup"&&e.keyCode===o.keyCode&&e.shiftKey===o.shiftKey&&e.altKey===o.altKey&&e.ctrlKey===o.ctrlKey){if(y._iFieldGroupTriggerDelay){clearTimeout(y._iFieldGroupTriggerDelay)}var r=this.getFieldGroupControl(),i=r?r._getFieldGroupIds():[];if(i.length>0){r.triggerValidateFieldGroup(i)}return true}return false};y.prototype.setFieldGroupControl=function(e){var n=e;while(n&&!(n instanceof t&&n.isA("sap.ui.core.Control"))){n=n.getParent()}var o=this.getFieldGroupControl();if(n!=o){var r=o?o._getFieldGroupIds():[],i=n?n._getFieldGroupIds():[],a=r.filter(function(e){return i.indexOf(e)<0});if(a.length>0){o.triggerValidateFieldGroup(a)}y._oFieldGroupControl=n}return this};y.prototype.getFieldGroupControl=function(){if(y._oFieldGroupControl&&!y._oFieldGroupControl.bIsDestroyed){return y._oFieldGroupControl}return null};y._oFieldGroupControl=null;y._iFieldGroupDelayTimer=null;y._oFieldGroupValidationKey={keyCode:a.ENTER,shiftKey:false,altKey:false,ctrlKey:false};y._oRenderLog=p;return y});
//# sourceMappingURL=UIArea.js.map